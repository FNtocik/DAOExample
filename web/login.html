<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link rel="stylesheet" href="style/style.css" type="text/css">
</head>
<body>
<div>
    <form>
        <input type="text" id="loginInput" value="" pattern="^\w+$"><br>
        <input type="password" id="passwordInput" value="" pattern="^\w+$"><br>
        <input type="button" onclick="login()" id="loginButton" value="">
    </form>
    <br>
    <p hidden id="errorOutput">Login or password is incorrect, try again</p>
</div>
</body>
<script src="javascript/validator.js"></script>
<script>
    setLocaleStrings();

    function setLocaleStrings() {
        var request = new XMLHttpRequest();
        request.open("POST", "locale", true);
        request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        request.onreadystatechange = function (ev) {
            if(this.readyState != XMLHttpRequest.DONE)
                return;
            var strings = JSON.parse(this.responseText);
            document.getElementById("loginInput").setAttribute("placeholder",
                strings.login);
            document.getElementById("passwordInput").setAttribute("placeholder",
                strings.password);
            document.getElementById("loginButton").value = strings.enter;
        };
        request.send("page=login");
    }

    function login() {
        if (!validateBeforePost()) return;
        var request = new XMLHttpRequest();
        request.open("POST", "login", true);
        request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        request.onreadystatechange = function (ev) {
            if(this.readyState != XMLHttpRequest.DONE)
                return;
            var response = JSON.parse(this.responseText);
            if(response.answer[0] === true)
                window.location.replace("subscription.html");
            else
                document.getElementById("errorOutput").hidden = false;
        };
        var login = document.getElementById("loginInput").value;
        var password = document.getElementById("passwordInput").value;
        request.send("login=" + login + "&password=" + password);
    }
</script>
</html>